{% extends 'base.html' %}
{% load static %}

{% block title %}รายการรออนุมัติ - {{ block.super }}{% endblock %}

{% block page_title %}<i class="bi bi-calendar2-check-fill me-2"></i>รายการรออนุมัติ{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="card shadow-sm border-0 rounded-3">
        <div class="card-header bg-white border-bottom-0 pt-3 pb-2">
            <h5 class="mb-0 fw-bold text-secondary">รายการจองที่กำลังรออนุมัติ</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0 align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col" class="ps-3">เวลา</th>
                        <th scope="col">ห้อง</th>
                        <th scope="col">หัวข้อ</th>
                        <th scope="col">ผู้จอง (แผนก)</th>
                        <th scope="col" class="text-center">จำนวนคน</th>
                        <th scope="col" class="text-center">การกระทำ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in pending_bookings %}
                    <tr>
                        <td class="ps-3">
                            {{ booking.start_time|date:"d M Y" }}<br>
                            <span class="text-muted small">{{ booking.start_time|date:"H:i" }} - {{ booking.end_time|date:"H:i" }}</span>
                        </td>
                        <td>{{ booking.room.name }}</td>
                        <td>
                            <strong>{{ booking.title }}</strong>
                            {% if booking.description %}
                                <p class="small text-muted mb-0">{{ booking.description|truncatewords:10 }}</p>
                            {% endif %}
                        </td>
                        <td>
                            {{ booking.booked_by.get_full_name|default:booking.booked_by.username }}
                            <br>
                            <span class="text-muted small">{{ booking.department|default:booking.booked_by.profile.department|default:"-" }}</span>
                        </td>
                        <td class="text-center">{{ booking.participant_count }}</td>
                        
                        {# --- START: แก้ไขส่วนปุ่ม Actions --- #}
                        <td class="text-center">
                            {# เปลี่ยนจาก btn-group เป็น d-inline-flex gap-1 #}
                            <div class="d-inline-flex gap-1" role="group">
                                
                                <a href="{% url 'booking_detail' booking.id %}" class="btn btn-sm btn-outline-primary" title="ดูรายละเอียด"> {# เพิ่ม btn-sm #}
                                    <i class="bi bi-info-circle-fill"></i>
                                </a>
                                
                                <form action="{% url 'approve_booking' booking.id %}" method="post" class="d-inline" onsubmit="return confirm('ยืนยันการอนุมัติ \"{{ booking.title|escapejs }}\" ?');">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-success" title="อนุมัติ"> {# เพิ่ม btn-sm #}
                                        <i class="bi bi-check-lg"></i>
                                    </button>
                                </form>
                                
                                <form action="{% url 'reject_booking' booking.id %}" method="post" class="d-inline" onsubmit="return confirm('ยืนยันการปฏิเสธ \"{{ booking.title|escapejs }}\" ?');">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-danger" title="ปฏิเสธ"> {# เพิ่ม btn-sm #}
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </form>
                                
                            </div>
                        </td>
                         {# --- END: แก้ไขส่วนปุ่ม Actions --- #}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted py-5">
                            <i class="bi bi-check-all fs-2 d-block mb-2"></i>
                            ไม่มีรายการรออนุมัติในขณะนี้
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}