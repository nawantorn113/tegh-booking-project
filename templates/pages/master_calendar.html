{% extends 'base.html' %}
{% block title %}ตารางเวลารวม - {{ block.super }}{% endblock %}

{% block extra_head %}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>
<style>
    #calendar { max-width: 1200px; margin: 0 auto; }
    .fc .fc-button-primary { background-color: #0d6efd; border-color: #0d6efd; }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="mb-0"><i class="bi bi-calendar3 me-2"></i>ตารางเวลารวม</h1>
        <p class="text-muted mb-0">ภาพรวมการจองห้องประชุมทั้งหมด</p>
    </div>
    <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
        <i class="bi bi-grid-fill me-1"></i> กลับไป Dashboard
    </a>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <div id='calendar'></div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            initialView: 'timeGridWeek',
            slotMinTime: '08:00:00',
            slotMaxTime: '19:00:00',
            events: "{% url 'api_bookings' %}", // ดึงข้อมูลการจองทั้งหมด
            eventDidMount: function(info) {
                // เพิ่มชื่อห้องเข้าไปใน Event title
                const roomName = info.event.extendedProps.room_name || '';
                const originalTitle = info.event.title;
                info.el.querySelector('.fc-event-title').innerHTML = `<b>${roomName}:</b> ${originalTitle}`;
            },
            eventClick: function(info) {
                // คลิกที่ Event เพื่อไปยังหน้าปฏิทินของห้องนั้นๆ
                const roomId = info.event.extendedProps.room_id;
                if (roomId) {
                    window.location.href = `/room/${roomId}/calendar/`;
                }
            }
        });
        calendar.render();
    });
</script>
{% endblock %}