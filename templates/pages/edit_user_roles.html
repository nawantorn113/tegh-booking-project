{% extends 'base.html' %}
{% load static %}

{% block title %}แก้ไขสิทธิ์: {{ user_to_edit.username }}{% endblock %}

{% block extra_head %}
<style>
    /* 1. พื้นหลังและฟอนต์ (เหมือนหน้า Login) */
    body {
        background-color: #eef2f6; /* สีเทาอมฟ้า */
        font-family: 'Kanit', sans-serif;
    }

    /* 2. การ์ดหลัก */
    .modern-card {
        background: #ffffff;
        border-radius: 20px; /* มุมโค้งมนมาก */
        border: none;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08); /* เงาฟุ้งนุ่ม */
        padding: 40px;
        position: relative;
        overflow: hidden;
    }

    /* 3. แถบสีตกแต่งด้านบน (เอกลักษณ์ของหน้า Login) */
    .card-accent {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 6px;
        background: linear-gradient(90deg, #4a55a8, #6c76e2);
    }

    /* 4. ไอคอนวงกลม */
    .icon-circle {
        width: 70px;
        height: 70px;
        background-color: #f3f6fd;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px auto;
        color: #4a55a8;
        font-size: 32px;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
    }

    /* 5. ปุ่มกด (สไตล์เดียวกับหน้า Login) */
    .btn-primary-custom {
        background-color: #4a55a8;
        border: none;
        padding: 12px 25px;
        border-radius: 12px;
        font-weight: 600;
        color: white;
        box-shadow: 0 4px 12px rgba(74, 85, 168, 0.3);
        transition: all 0.3s;
    }
    .btn-primary-custom:hover {
        background-color: #3b4285;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(74, 85, 168, 0.4);
        color: white;
    }

    .btn-outline-custom {
        border: 2px solid #e0e0e0;
        color: #555;
        border-radius: 12px;
        padding: 12px 25px;
        font-weight: 500;
        background: white;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
    }
    .btn-outline-custom:hover {
        background-color: #f8f9fa;
        border-color: #d1d1d1;
        color: #333;
    }

    /* 6. สไตล์สำหรับตัวเลือก (List Item) */
    .selection-item {
        border: 1px solid #f0f0f0;
        border-radius: 12px;
        margin-bottom: 10px;
        transition: all 0.2s;
        background-color: #fff;
    }
    .selection-item:hover {
        background-color: #fafafa;
        border-color: #e0e0e0;
        transform: translateX(5px);
    }
    
    /* เมื่อติ๊กเลือก */
    .btn-check:checked + .selection-item {
        border-color: #4a55a8;
        background-color: #f0f4ff;
    }
    .btn-check:checked + .selection-item .icon-box {
        background-color: #4a55a8;
        color: white;
    }

    .icon-box {
        width: 40px; height: 40px;
        border-radius: 10px;
        background-color: #f1f3f5;
        color: #495057;
        display: flex; align-items: center; justify-content: center;
        transition: all 0.2s;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-7 col-md-9">
            
            <div class="modern-card">
                <div class="card-accent"></div>

                <div class="text-center mb-4">
                    <div class="icon-circle">
                        <i class="bi bi-person-gear"></i>
                    </div>
                    
                    <h3 class="fw-bold text-dark">จัดการสิทธิ์การใช้งาน</h3>
                    <p class="text-muted">
                        ผู้ใช้: <span class="badge bg-light text-dark border">{{ user_to_edit.username }}</span>
                    </p>
                </div>

                <form method="post">
                    {% csrf_token %}
                    
                    <h6 class="fw-bold text-secondary mb-3 small text-uppercase">เลือกกลุ่ม (Groups)</h6>
                    
                    <div class="mb-4">
                        {% for group in all_groups %}
                            <input type="checkbox" class="btn-check" name="groups" id="grp_{{ group.id }}" value="{{ group.id }}"
                                {% if group.id in user_group_pks %}checked{% endif %}>
                            
                            <label class="selection-item p-3 d-flex align-items-center gap-3 cursor-pointer w-100" for="grp_{{ group.id }}" style="cursor: pointer;">
                                
                                <div class="icon-box flex-shrink-0">
                                    {% if group.name == 'Admin' %}
                                        <i class="bi bi-lightning-fill"></i>
                                    {% elif group.name == 'Approver' %}
                                        <i class="bi bi-file-earmark-check-fill"></i>
                                    {% else %}
                                        <i class="bi bi-person-fill"></i>
                                    {% endif %}
                                </div>
                                
                                <div class="flex-grow-1">
                                    <h6 class="fw-bold mb-0 text-dark">{{ group.name }}</h6>
                                    <small class="text-muted">
                                        {% if group.name == 'Admin' %}
                                            เข้าถึงทุกเมนูและจัดการระบบ
                                        {% elif group.name == 'Approver' %}
                                            อนุมัติการจองห้องประชุม
                                        {% else %}
                                            สิทธิ์ผู้ใช้งานทั่วไป
                                        {% endif %}
                                    </small>
                                </div>

                                {% if group.id in user_group_pks %}
                                <div class="text-primary">
                                    <i class="bi bi-check-circle-fill fs-5"></i>
                                </div>
                                {% endif %}
                            </label>
                        {% empty %}
                            <div class="alert alert-light text-center border">
                                <i class="bi bi-exclamation-circle me-2"></i> ไม่พบข้อมูลกลุ่ม
                            </div>
                        {% endfor %}
                    </div>

                    <div class="d-flex justify-content-between align-items-center pt-3 border-top mt-4">
                        <a href="{% url 'user_management' %}" class="btn-outline-custom">
                            ยกเลิก
                        </a>
                        <button type="submit" class="btn-primary-custom px-4">
                            บันทึกข้อมูล
                        </button>
                    </div>
                    
                </form>
            </div>
            
        </div>
    </div>
</div>
{% endblock %}