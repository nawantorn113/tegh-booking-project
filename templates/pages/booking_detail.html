{% extends "base.html" %}
{% load static %}

{% block title %}รายละเอียด: {{ booking.title }}{% endblock %}

{% block extra_head %}
<style>
    /* (CSS นี้สำหรับจัด 'คำอธิบาย' กับ 'เนื้อหา' ให้ตรงกัน) 
    */
    .detail-grid {
        display: grid;
        /* ความกว้างของคอลัมน์ซ้าย (คำอธิบาย) */
        grid-template-columns: 150px 1fr; 
        gap: 1rem;
    }
    .detail-grid dt {
        font-weight: 600;
        color: #555;
        text-align: right;
    }
    .detail-grid dd {
        margin-bottom: 0.75rem;
        color: #000;
    }
    
    /* [ใหม่] จัดตำแหน่งปุ่มปิด */
    .page-header-custom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #dee2e6;
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">

        <div class="content-card">
            
            <div class="page-header-custom">
                <h4 class="mb-0 text-primary fw-bold">{{ booking.title }}</h4>
                
                <a href="javascript:history.back()" class="btn-close" aria-label="Close" title="ปิดหน้านี้"></a>

            </div>
            
            <dl class="detail-grid mt-4">
                <dt>ห้องประชุม:</dt>
                <dd>{{ booking.room.name }}</dd>
                
                <dt>สถานะ:</dt>
                <dd>
                    {% if booking.status == 'APPROVED' %}
                        <span class="badge bg-success">อนุมัติแล้ว</span>
                    {% elif booking.status == 'PENDING' %}
                        <span class="badge bg-warning text-dark">รออนุมัติ</span>
                    {% elif booking.status == 'REJECTED' %}
                        <span class="badge bg-danger">ไม่อนุมัติ</span>
                    {% elif booking.status == 'CANCELLED' %}
                        <span class="badge bg-secondary">ยกเลิกแล้ว</span>
                    {% endif %}
                </dd>

                <dt>ผู้จอง:</dt>
                <dd>{{ booking.user.get_full_name|default:booking.user.username }}</dd>

                <dt>แผนก:</dt>
                <dd>{{ booking.department|default:"-" }}</dd>

                <dt>เวลาเริ่มต้น:</dt>
                <dd>{{ booking.start_time|date:"l, d F Y - H:i" }} น.</dd>

                <dt>เวลาสิ้นสุด:</dt>
                <dd>{{ booking.end_time|date:"l, d F Y - H:i" }} น.</dd>

                <dt>จำนวนคน:</dt>
                <dd>{{ booking.participant_count }} คน</dd>

                <dt>ผู้เข้าร่วม:</dt>
                <dd>
                    {% for p in booking.participants.all %}
                        <span class="badge bg-light text-dark border me-1">{{ p.get_full_name|default:p.username }}</span>
                    {% empty %}
                        (ไม่มีรายชื่อผู้เข้าร่วม)
                    {% endfor %}
                </dd>
                
                {% if booking.description %}
                    <dt>รายละเอียด:</dt>
                    <dd>{{ booking.description|linebreaksbr }}</dd>
                {% endif %}

                {% if booking.additional_requests %}
                    <dt>คำขอเพิ่มเติม:</dt>
                    <dd>{{ booking.additional_requests|linebreaksbr }}</dd>
                {% endif %}
                
                {% if booking.presentation_file %}
                    <dt>ไฟล์แนบ:</dt>
                    <dd>
                        <a href="{{ booking.presentation_file.url }}" target="_blank">
                            <i class="bi bi-file-earmark-arrow-down"></i> 
                            {{ booking.presentation_file.name|cut:"presentations/" }}
                        </a>
                    </dd>
                {% endif %}
            </dl>
            
            {% if can_edit_or_cancel %}
                <hr class="my-4">
                <div class="d-flex justify-content-end gap-2">
                    
                    <form action="{% url 'delete_booking' booking.id %}" method="POST" onsubmit="return confirm('คุณแน่ใจหรือไม่ว่าต้องการยกเลิกการจองนี้?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-danger">
                            <i class="bi bi-trash-fill"></i> ยกเลิกการจอง
                        </button>
                    </form>

                    <a href="{% url 'edit_booking' booking.id %}" class="btn btn-warning">
                        <i class="bi bi-pencil-fill"></i> แก้ไข
                    </a>
                </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}