{% extends 'base.html' %}
{% load static %}

{% block title %}แก้ไขการจอง: {{ booking.title }}{% endblock %}
{% block page_title %}แก้ไขการจอง{% endblock %}

{% block extra_head %}
{{ form.media.css }}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />

<style>
    body {
        background-color: #f8f9fa;
    }

    .form-container {
        max-width: 480px;
        margin: 50px auto;
        padding: 25px 30px;
        background: #ffffff;
        border-radius: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .form-label {
        font-weight: 600;
        margin-top: 10px;
    }

    .form-control, .select2-selection {
        border-radius: 10px !important;
    }

    /* ✅ ปรับความกว้าง Select2 ให้กินเต็มบล็อกจริงๆ */
    .select2-container {
        min-width: 100% !important;
        width: 100% !important;
        display: block !important;
    }

    /* ปรับให้สูงขึ้นหน่อย */
    .select2-selection--multiple {
        min-height: 45px !important;
    }

    .btn {
        border-radius: 10px;
        padding: 8px 20px;
    }

    .text-center {
        margin-top: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <h5 class="text-center mb-4"><strong>แก้ไขการจองห้อง: {{ booking.room.name }}</strong></h5>

    <form method="POST" enctype="multipart/form-data" id="bookingForm">
        {% csrf_token %}
        <div class="mb-3">
            <label class="form-label">หัวข้อการประชุม</label>
            {{ form.title }}
        </div>

        <div class="row">
            <div class="col">
                <label class="form-label">ประเภท (ถ้ามี)</label>
                {{ form.meeting_type }}
            </div>
            <div class="col">
                <label class="form-label">แผนกผู้จอง</label>
                {{ form.department }}
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label class="form-label">วัน/เวลา เริ่มต้น</label>
                {{ form.start_time }}
            </div>
            <div class="col">
                <label class="form-label">วัน/เวลา สิ้นสุด</label>
                {{ form.end_time }}
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">จำนวนผู้เข้าร่วม</label>
            {{ form.participants_count }}
        </div>

        <!-- ✅ ส่วนนี้คือจุดสำคัญ -->
        <div class="mb-3" style="display: block; width: 100%;">
            <label class="form-label">รายชื่อผู้เข้าร่วม</label>
            <div class="participant-select" style="width: 100%;">
                {{ form.participants }}
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">รายละเอียดการประชุม / วาระการประชุม</label>
            {{ form.details }}
        </div>

        <div class="mb-3">
            <label class="form-label">ไฟล์เอกสาร</label>
            {{ form.attachment }}
        </div>

        <div class="mb-3">
            <label class="form-label">อุปกรณ์เพิ่มเติม</label>
            {{ form.equipment }}
        </div>

        <div class="mb-3">
            <label class="form-label">หมายเหตุ</label>
            {{ form.note }}
        </div>

        <div class="text-center">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
            <button type="submit" class="btn btn-primary">ยืนยัน</button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
{{ form.media.js }}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/th.js"></script>

<script>
$(document).ready(function() {
    // ✅ เรียก Select2
    const $selects = $('select').select2({
        theme: 'bootstrap-5',
        language: 'th',
        width: 'resolve'
    });

    // ✅ บังคับให้มันยืดเต็มแน่นอน (กันบั๊กของ select2)
    function fixSelect2Width() {
        $('.select2-container').css({
            width: '100%',
            minWidth: '100%',
            maxWidth: '100%'
        });
    }

    // เรียกตอนโหลดและหลัง render เสร็จ
    fixSelect2Width();
    setTimeout(fixSelect2Width, 500);
    $(window).on('resize', fixSelect2Width);
});
</script>
{% endblock %}
