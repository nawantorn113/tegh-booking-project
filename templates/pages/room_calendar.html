{% extends 'base.html' %}
{% load static %}  {# เพิ่มบรรทัดนี้เพื่อใช้ static tag #}

{% block title %}ตารางการจองห้อง {{ room.name }}{% endblock %}

{% block page_title %}
<i class="bi bi-calendar3 me-2"></i> ตารางการจองห้อง: {{ room.name }}
{% endblock %}

{% block extra_head %}
<style>
    #calendar {
        max-width: 100%;
        margin: 2rem auto;
    }
    .room-images img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 8px;
    }
    .carousel-inner img {
        height: 300px;
        object-fit: cover;
    }
</style>
{% endblock %}

{% block content %}

<!-- Room Images Carousel -->
<div id="roomCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
    <div class="carousel-inner room-images">
        {% for img in room.images.all %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <img src="{{ img.file.url }}" class="d-block w-100" alt="Room image {{ forloop.counter }}">
        </div>
        {% empty %}
        <div class="carousel-item active">
            <img src="{% static 'images/no_image.png' %}" class="d-block w-100" alt="No image">
        </div>
        {% endfor %}
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#roomCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#roomCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<!-- Calendar -->
<div class="card shadow-sm">
    <div class="card-body">
        <div id="calendar"></div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
        },
        events: [
            {% for booking in bookings %}
            {
                title: '{{ booking.user.get_full_name|escapejs }}',
                start: '{{ booking.start|date:"Y-m-d\\TH:i:s" }}',
                end: '{{ booking.end|date:"Y-m-d\\TH:i:s" }}',
                color: '{{ booking.color|default:"#3788d8" }}'
            },
            {% endfor %}
        ],
        navLinks: true,
        editable: false,
        dayMaxEvents: true,
        dateClick: function(info) {
            var bookingUrl = "{% url 'create_booking' room.id %}?date=" + info.dateStr;
            window.location.href = bookingUrl;
        }
    });

    calendar.render();
});
</script>
{% endblock %}
