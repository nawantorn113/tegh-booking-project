{% extends 'base.html' %}
{% load static %}

{% block title %}à¸›à¸à¸´à¸—à¸´à¸™à¸«à¹‰à¸­à¸‡: {{ room.name }}{% endblock %}
{% block page_title %}{% endblock %}

{% block extra_head %}
{{ form.media.css }}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/main.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />

<style>
Â  Â  :root {
Â  Â  Â  Â  --fc-border-color: #e9ecef;
Â  Â  Â  Â  --fc-today-bg-color: #f8f9fa;
Â  Â  Â  Â  --fc-button-active-bg-color: #4338ca;
Â  Â  Â  Â  --fc-button-active-border-color: #4338ca;
Â  Â  }
Â  Â  .fc { font-family: 'Kanit', sans-serif; }
Â  Â  .fc .fc-toolbar-title { font-size: 1.25rem; font-weight: 500; }
Â  Â  .room-image { height: 250px; object-fit: cover; border-radius: 0.5rem; }
Â  Â  #calendar { margin-top: 1.5rem; }
Â  Â  #bookingFormContainer { display: none; }
Â  Â  
Â  Â  .select2-container { z-index: 1056; } 
Â  Â  
Â  Â  /* ğŸ¯ CSS à¸šà¸±à¸‡à¸„à¸±à¸šà¸„à¸§à¸²à¸¡à¸à¸§à¹‰à¸²à¸‡à¸ªà¸¸à¸”à¹† à¹ƒà¸«à¹‰à¸à¸±à¸š Select2 Container à¸—à¸±à¹ˆà¸§à¹„à¸› */
Â  Â  .select2-container {
Â  Â  Â  Â  min-width: 100% !important;
Â  Â  Â  Â  width: 100% !important;
Â  Â  Â  Â  display: block !important;
Â  Â  }

Â  Â  /* à¸ªà¹„à¸•à¸¥à¹Œà¸ªà¸³à¸«à¸£à¸±à¸š Event à¸—à¸µà¹ˆà¸¥à¸²à¸à¹„à¸”à¹‰ */
Â  Â  .fc-event-draggable, .fc-event-resizable {
Â  Â  Â  Â  cursor: move;
Â  Â  }
Â  Â  .fc-event-main:hover {
Â  Â  Â  Â  opacity: 0.8;
Â  Â  }
</style>
{% endblock %}


{% block content %}
<div class="container-fluid py-4">

Â  Â  {# --- à¸ªà¹ˆà¸§à¸™à¹à¸ªà¸”à¸‡à¸£à¸¹à¸›à¸ à¸²à¸à¹à¸¥à¸°à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸«à¹‰à¸­à¸‡ --- #}
Â  Â  <div class="content-card shadow-sm border p-3 p-md-4 mb-4">
Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  Â  <div class="col-lg-6 mb-3 mb-lg-0">
Â  Â  Â  Â  Â  Â  Â  Â  {% if room.image %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="{{ room.image.url }}" class="d-block w-100 room-image" alt="à¸£à¸¹à¸›à¸«à¹‰à¸­à¸‡">
Â  Â  Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-light text-muted d-flex align-items-center justify-content-center room-image">à¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸¹à¸›à¸ à¸²à¸à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡</div>
Â  Â  Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="col-lg-6">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="fw-bold text-primary">{{ room.name }}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-muted small mb-3">{{ room.location|default:"(à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡)" }}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="mb-2"><i class="bi bi-people-fill me-2 text-muted"></i> <strong>à¸„à¸§à¸²à¸¡à¸ˆà¸¸:</strong> {{ room.capacity }} à¸„à¸™</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="mb-2"><i class="bi bi-building me-2 text-muted"></i> <strong>à¸­à¸²à¸„à¸²à¸£:</strong> {{ room.building|default:"-" }} (à¸Šà¸±à¹‰à¸™ {{ room.floor|default:"-" }})</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="mb-1"><i class="bi bi-tools me-2 text-muted"></i> <strong>à¸­à¸¸à¸›à¸à¸£à¸“à¹Œ:</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="small text-muted ps-4 mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ room.equipment_in_room|default:"(à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¸£à¸°à¸šà¸¸)"|linebreaksbr }}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  {# --- à¸ªà¹ˆà¸§à¸™à¸›à¸à¸´à¸—à¸´à¸™à¸à¸²à¸£à¸ˆà¸­à¸‡ --- #}
Â  Â  <div class="content-card shadow-sm border p-3 p-md-4">
Â  Â  Â  Â  <h5 class="mb-0">à¸•à¸²à¸£à¸²à¸‡à¸à¸²à¸£à¸ˆà¸­à¸‡à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡ (à¸„à¸¥à¸´à¸à¸—à¸µà¹ˆà¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸§à¹ˆà¸²à¸‡à¹€à¸à¸·à¹ˆà¸­à¸ˆà¸­à¸‡)</h5>
Â  Â  Â  Â  <div id="calendar"></div>
Â  Â  </div>
</div>

{# --- à¹‚à¸„à¹‰à¸”à¸—à¸µà¹ˆà¸‹à¹ˆà¸­à¸™à¹„à¸§à¹‰à¸ªà¸³à¸«à¸£à¸±à¸š Modal à¹à¸¥à¸° Form (à¸ˆà¸³à¹€à¸›à¹‡à¸™) --- #}
<div id="bookingFormContainer" style="display:none;">
Â  Â  <form id="hiddenBookingForm" action="{% url 'create_booking' room.id %}" method="post" enctype="multipart/form-data">
Â  Â  Â  Â  {% csrf_token %}
Â  Â  Â  Â  {{ form.as_p }}
Â  Â  </form>
</div>

<div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
Â  Â  <div class="modal-dialog modal-lg">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="modal-title" id="bookingModalLabel">à¸ˆà¸­à¸‡à¸«à¹‰à¸­à¸‡: {{ room.name }}</h5>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="modal-body" id="modalBookingBody">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="modal-footer">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">à¸¢à¸à¹€à¸¥à¸´à¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary" form="hiddenBookingForm">à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸ˆà¸­à¸‡</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>
{% endblock %}


{% block extra_scripts %}
{{ form.media.js }}

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/th.js"></script>


<script>
window.onload = function() {
Â  Â  
Â  Â  // (à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹„à¸¥à¸šà¸£à¸²à¸£à¸µà¸à¸·à¹‰à¸™à¸à¸²à¸™)
Â  Â  if (typeof FullCalendar === 'undefined' || typeof bootstrap === 'undefined' || typeof $ === 'undefined' || typeof yl === 'undefined') {
Â  Â  Â  Â  console.error("Required JS libraries not loaded (jQuery, Bootstrap, FullCalendar, or DAL/yl).");
Â  Â  Â  Â  document.getElementById('calendar').innerHTML = '<div class="alert alert-danger">à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: à¹‚à¸«à¸¥à¸”à¹„à¸¥à¸šà¸£à¸²à¸£à¸µà¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¸¸à¸“à¸²à¸¥à¹‰à¸²à¸‡à¹à¸„à¸Š (Ctrl+Shift+R)</div>';
Â  Â  Â  Â  return; 
Â  Â  }
Â  Â  
Â  Â  // ğŸ’¡ à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸šà¸±à¸‡à¸„à¸±à¸šà¸„à¸§à¸²à¸¡à¸à¸§à¹‰à¸²à¸‡ Select2 à¹ƒà¸«à¹‰à¹€à¸•à¹‡à¸¡ 100% (à¸„à¸µà¸¢à¹Œà¸«à¸¥à¸±à¸)
Â  Â  // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸™à¸µà¹‰à¸ˆà¸°à¸–à¸¹à¸à¹€à¸£à¸µà¸¢à¸à¹€à¸¡à¸·à¹ˆà¸­ Modal à¹€à¸›à¸´à¸”
Â  Â  function fixSelect2Width() {
Â  Â  Â  Â  var $participantsField = $('#id_participants');
Â  Â  Â  Â  
Â  Â  Â  Â  // 1. à¸šà¸±à¸‡à¸„à¸±à¸šà¸”à¹‰à¸§à¸¢ CSS à¸—à¸±à¸™à¸—à¸µ
Â  Â  Â  Â  $participantsField.closest('.select2-container').css({
Â  Â  Â  Â  Â  Â  width: '100%',
Â  Â  Â  Â  Â  Â  minWidth: '100%',
Â  Â  Â  Â  Â  Â  maxWidth: '100%'
Â  Â  Â  Â  });

Â  Â  Â  Â  // 2. à¸ªà¸±à¹ˆà¸‡à¹ƒà¸«à¹‰ Select2 à¸„à¸³à¸™à¸§à¸“à¸•à¸±à¸§à¹€à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ (à¸—à¹ˆà¸²à¹„à¸¡à¹‰à¸•à¸²à¸¢à¹à¸à¹‰à¸šà¸±à¹Šà¸)
Â  Â  Â  Â  $participantsField.trigger('change.select2');
Â  Â  Â  Â  console.log("Select2 width forcefully recalculated.");
Â  Â  }
Â  Â  

Â  Â  var calendarEl = document.getElementById('calendar');
Â  Â  var hiddenForm = document.getElementById('hiddenBookingForm');
Â  Â  var modalBody = document.getElementById('modalBookingBody');
Â  Â  var startTimeField = document.getElementById('id_start_time');
Â  Â  var endTimeField = document.getElementById('id_end_time');
Â  Â  var bookingModalEl = document.getElementById('bookingModal'); 
Â  Â  var bookingModal = new bootstrap.Modal(bookingModalEl);
Â  Â  
Â  Â  if (!startTimeField || !endTimeField) {
Â  Â  Â  Â  console.error("à¹„à¸¡à¹ˆà¸à¸šà¸Šà¹ˆà¸­à¸‡ input #id_start_time à¸«à¸£à¸·à¸­ #id_end_time");
Â  Â  }

Â  Â  // --- à¹‚à¸„à¹‰à¸”à¸—à¸µà¹ˆà¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸£à¸¥à¸²à¸à¹à¸¥à¸°à¸¢à¸·à¸”à¸«à¸” Event ---
Â  Â  function sendEventUpdate(info, revert) {
Â  Â  Â  Â  var event = info.event;
Â  Â  Â  Â  var new_start = event.start.toISOString();
Â  Â  Â  Â  var new_end = event.end ? event.end.toISOString() : null;
Â  Â  Â  Â  
Â  Â  Â  Â  if (new Date(new_start) < new Date()) {
Â  Â  Â  Â  Â  Â  alert("à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¢à¹‰à¸²à¸¢à¸à¸²à¸£à¸ˆà¸­à¸‡à¹„à¸›à¹ƒà¸™à¸­à¸”à¸µà¸•à¹„à¸”à¹‰");
Â  Â  Â  Â  Â  Â  revert(); 
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!confirm(`à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¢à¹‰à¸²à¸¢ "${event.title}" à¹„à¸›à¸¢à¸±à¸‡à¹€à¸§à¸¥à¸²à¸™à¸µà¹‰à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?`)) {
Â  Â  Â  Â  Â  Â  revert();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  fetch("{% url 'update_booking_time' %}", {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  'X-CSRFToken': '{{ csrf_token }}'
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  Â  Â  booking_id: event.id,
Â  Â  Â  Â  Â  Â  Â  Â  start_time: new_start,
Â  Â  Â  Â  Â  Â  Â  Â  end_time: new_end
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  })
Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  if (data.status === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('Update successful:', data.message);
Â  Â  Â  Â  Â  Â  Â  Â  calendar.refetchEvents(); 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  alert('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: ' + data.message);
Â  Â  Â  Â  Â  Â  Â  Â  revert();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  console.error('Error updating event:', error);
Â  Â  Â  Â  Â  Â  alert('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­');
Â  Â  Â  Â  Â  Â  revert();
Â  Â  Â  Â  });
Â  Â  }
Â  Â  // --- à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”à¹‚à¸„à¹‰à¸”à¸—à¸µà¹ˆà¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸£à¸¥à¸²à¸à¹à¸¥à¸°à¸¢à¸·à¸”à¸«à¸” Event ---


Â  Â  var calendar = new FullCalendar.Calendar(calendarEl, {
Â  Â  Â  Â  initialView: 'timeGridWeek', 
Â  Â  Â  Â  locale: 'th',
Â  Â  Â  Â  // ... (FullCalendar config à¸­à¸·à¹ˆà¸™à¹†)
Â  Â  Â  Â  
Â  Â  Â  Â  headerToolbar: {
Â  Â  Â  Â  Â  Â  left: 'prev,next today',
Â  Â  Â  Â  Â  Â  center: 'title',
Â  Â  Â  Â  Â  Â  right: 'dayGridMonth,timeGridWeek,timeGridDay' 
Â  Â  Â  Â  },
Â  Â  Â  Â  buttonText: { today: 'à¸§à¸±à¸™à¸™à¸µà¹‰', month: 'à¹€à¸”à¸·à¸­à¸™', week: 'à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ', day: 'à¸§à¸±à¸™' },
Â  Â  Â  Â  
Â  Â  Â  Â  allDaySlot: false, 
Â  Â  Â  Â  slotMinTime: '07:30:00', 
Â  Â  Â  Â  slotMaxTime: '18:00:00',
Â  Â  Â  Â  businessHours: {
Â  Â  Â  Â  Â  Â  daysOfWeek: [ 0, 1, 2, 3, 4, 5, 6 ],
Â  Â  Â  Â  Â  Â  startTime: '08:00',
Â  Â  Â  Â  Â  Â  endTime: '18:00',
Â  Â  Â  Â  },
Â  Â  Â  Â  
Â  Â  Â  Â  selectable: true, 
Â  Â  Â  Â  selectMirror: true, 
Â  Â  Â  Â  nowIndicator: true, 
Â  Â  Â  Â  
Â  Â  Â  Â  editable: true, 
Â  Â  Â  Â  eventDrop: sendEventUpdate, 
Â  Â  Â  Â  eventResize: sendEventUpdate, 
Â  Â  Â  Â  
Â  Â  Â  Â  selectAllow: function(selectInfo) {
Â  Â  Â  Â  Â  Â  var now = new Date();
Â  Â  Â  Â  Â  Â  if (selectInfo.start < now) { return false; }
Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  },

Â  Â  Â  Â  select: function(info) {
Â  Â  Â  Â  Â  Â  var now = new Date();
Â  Â  Â  Â  Â  Â  if (info.start < now) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸ˆà¸­à¸‡à¸¢à¹‰à¸­à¸™à¸«à¸¥à¸±à¸‡à¹„à¸”à¹‰");
Â  Â  Â  Â  Â  Â  Â  Â  calendar.unselect();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // (à¸ˆà¸±à¸”à¸à¸²à¸£à¹€à¸§à¸¥à¸²à¹€à¸¡à¸·à¹ˆà¸­à¸„à¸¥à¸´à¸à¹ƒà¸™ Month View)
Â  Â  Â  Â  Â  Â  if (info.view.type.includes('dayGrid')) { 
Â  Â  Â  Â  Â  Â  Â  Â  info.start.setHours(8, 0, 0, 0); 
Â  Â  Â  Â  Â  Â  Â  Â  var end = new Date(info.end.getTime()); 
Â  Â  Â  Â  Â  Â  Â  Â  if (info.end.getDate() !== info.start.getDate()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  end.setDate(end.getDate() - 1); 
Â  Â  Â  Â  Â  Â  Â  Â  } 
Â  Â  Â  Â  Â  Â  Â  Â  end.setHours(18, 0, 0, 0);
Â  Â  Â  Â  Â  Â  Â  Â  info.end = end;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  var startStr = new Date(info.start.getTime() - (info.start.getTimezoneOffset() * 60000)).toISOString().substring(0, 16);
Â  Â  Â  Â  Â  Â  var endStr = new Date(info.end.getTime() - (info.end.getTimezoneOffset() * 60000)).toISOString().substring(0, 16);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  modalBody.appendChild(hiddenForm); 
Â  Â  Â  Â  Â  Â  startTimeField.value = startStr;
Â  Â  Â  Â  Â  Â  endTimeField.value = endStr;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // ğŸ¯ à¹à¸à¹‰à¹„à¸‚: à¸ªà¸±à¹ˆà¸‡à¹ƒà¸«à¹‰ Select2 à¸–à¸¹à¸à¸ªà¸£à¹‰à¸²à¸‡à¸”à¹‰à¸§à¸¢à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² 'dropdownParent' à¹à¸¥à¸° 'width' à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡
Â  Â  Â  Â  Â  Â  if (typeof yl !== 'undefined' && yl.register) {
Â  Â  Â  Â  Â  Â  Â  Â  var $participants = $(modalBody).find('#id_participants');
Â  Â  Â  Â  Â  Â  Â  Â  if ($participants.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if ($participants.hasClass('select2-hidden-accessible')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $participants.select2('destroy');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  yl.register($participants, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropdownParent: $('#bookingModal'), // **à¸—à¹ˆà¸²à¹„à¸¡à¹‰à¸•à¸²à¸¢ 1**
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: '100%', Â  Â  Â  Â  Â  Â  Â  Â  Â // **à¸—à¹ˆà¸²à¹„à¸¡à¹‰à¸•à¸²à¸¢ 2**
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  theme: 'bootstrap-5'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  bookingModal.show();
Â  Â  Â  Â  },
Â  Â  Â  Â  
Â  Â  Â  Â  events: "{% url 'bookings_api' %}?room_id={{ room.id }}",

Â  Â  Â  Â  eventDataTransform: function(eventData) {
Â  Â  Â  Â  Â  Â  // ... (à¹‚à¸„à¹‰à¸” Event Data Transform à¹€à¸”à¸´à¸¡)
Â  Â  Â  Â  Â  Â  let props = eventData.extendedProps || {};
Â  Â  Â  Â  Â  Â  var now = new Date();
Â  Â  Â  Â  Â  Â  var eventStart = new Date(eventData.start);
Â  Â  Â  Â  Â  Â  var eventEnd = new Date(eventData.end);

Â  Â  Â  Â  Â  Â  if (props.status === 'PENDING') {
Â  Â  Â  Â  Â  Â  Â  Â  eventData.backgroundColor = '#ffc107'; 
Â  Â  Â  Â  Â  Â  Â  Â  eventData.borderColor = '#ffc107';
Â  Â  Â  Â  Â  Â  Â  Â  eventData.title = `[à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´] ${eventData.title}`;
Â  Â  Â  Â  Â  Â  } else if (props.status === 'APPROVED') {
Â  Â  Â  Â  Â  Â  Â  Â  if (now >= eventStart && now < eventEnd) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventData.backgroundColor = '#dc3545'; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventData.borderColor = '#dc3545';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventData.title = `[à¸à¸³à¸¥à¸±à¸‡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™] ${eventData.title}`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventData.backgroundColor = '#198754'; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventData.borderColor = '#198754';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  eventData.title = `[à¸ˆà¸­à¸‡à¹à¸¥à¹‰à¸§] ${eventData.title}`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (eventData.display !== 'background') {
Â  Â  Â  Â  Â  Â  Â  Â  eventData.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  var currentUserId = {{ request.user.id|default:"null" }};
Â  Â  Â  Â  Â  Â  var isAdmin = {{ is_admin_user|yesno:"true,false" }};
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (props.user_id == currentUserId || isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  eventData.editable = true;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  eventData.editable = false;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return eventData;
Â  Â  Â  Â  },

Â  Â  Â  Â  eventClick: function(info) {
Â  Â  Â  Â  Â  Â  if (info.event.display === 'background') { return false; }
Â  Â  Â  Â  Â  Â  window.location.href = "{% url 'booking_detail' 0 %}".replace('0', info.event.id);
Â  Â  Â  Â  },
Â  Â  Â  Â  
Â  Â  Â  Â  viewDidMount: function() {
Â  Â  Â  Â  Â  Â  // ğŸ¯ à¹à¸à¹‰à¹„à¸‚: à¹€à¸à¸´à¹ˆà¸¡ Listener à¸—à¸µà¹ˆà¸™à¸µà¹ˆà¹€à¸à¸·à¹ˆà¸­à¸ªà¸±à¹ˆà¸‡à¹ƒà¸«à¹‰ Select2 à¸„à¸³à¸™à¸§à¸“à¸„à¸§à¸²à¸¡à¸à¸§à¹‰à¸²à¸‡à¹ƒà¸«à¸¡à¹ˆà¹€à¸¡à¸·à¹ˆà¸­ Modal à¹€à¸›à¸´à¸”
Â  Â  Â  Â  Â  Â  bookingModalEl.addEventListener('shown.bs.modal', function () {
Â  Â  Â  Â  Â  Â  Â  Â  fixSelect2Width(); // **à¸—à¹ˆà¸²à¹„à¸¡à¹‰à¸•à¸²à¸¢ 3**
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // (à¹€à¸ªà¸£à¸´à¸¡: à¹‚à¸Ÿà¸à¸±à¸ªà¸Šà¹ˆà¸­à¸‡à¸„à¹‰à¸™à¸«à¸²)
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#bookingModal').find('.select2-search__field').first().focus();
Â  Â  Â  Â  Â  Â  Â  Â  }, 100);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // à¹‚à¸„à¹‰à¸”à¹€à¸”à¸´à¸¡à¸•à¸­à¸™ Modal à¸›à¸´à¸”
Â  Â  Â  Â  Â  Â  bookingModalEl.addEventListener('hidden.bs.modal', function () {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('bookingFormContainer').appendChild(hiddenForm);
Â  Â  Â  Â  Â  Â  Â  Â  if ($.fn.select2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#id_participants').select2('destroy');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  });
Â  Â  
Â  Â  calendar.render();
};
</script>
{% endblock %}