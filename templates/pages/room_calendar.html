{% extends 'base.html' %}
{% block title %}รายงาน - {{ block.super }}{% endblock %}

{% block content %}
<h1 class="mb-4">รายงานสรุป: {{ report_title }}</h1>

<div class="card shadow-sm mb-4">
    <div class="card-body">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label">ช่วงเวลา</label>
                <div class="btn-group w-100">
                    <a href="?period=daily&department={{ current_department }}" class="btn {% if current_period == 'daily' %}btn-primary{% else %}btn-outline-primary{% endif %}">รายวัน</a>
                    <a href="?period=weekly&department={{ current_department }}" class="btn {% if current_period == 'weekly' %}btn-primary{% else %}btn-outline-primary{% endif %}">รายสัปดาห์</a>
                    <a href="?period=monthly&department={{ current_department }}" class="btn {% if current_period == 'monthly' %}btn-primary{% else %}btn-outline-primary{% endif %}">รายเดือน</a>
                </div>
            </div>
            <div class="col-md-4">
                <label for="department" class="form-label">แผนก</label>
                <select name="department" id="department" class="form-select" onchange="this.form.submit()">
                    <option value="">-- ทุกแผนก --</option>
                    {% for dept in all_departments %}
                    <option value="{{ dept }}" {% if current_department == dept %}selected{% endif %}>{{ dept }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-5 text-end">
                <a href="{% url 'export_reports_excel' %}?period={{ current_period }}&department={{ current_department }}" class="btn btn-success"><i class="bi bi-file-earmark-excel-fill me-1"></i> Export to Excel</a>
                <a href="{% url 'export_reports_pdf' %}?period={{ current_period }}&department={{ current_department }}" class="btn btn-danger"><i class="bi bi-file-earmark-pdf-fill me-1"></i> Export to PDF</a>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>ชื่อห้องประชุม</th>
                        <th class="text-center">จำนวนครั้งที่ใช้งาน</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stat in room_usage_stats %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ stat.name }}</td>
                        <td class="text-center">{{ stat.booking_count }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="3" class="text-center text-muted">ไม่พบข้อมูล</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}